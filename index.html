<!DOCTYPE html>
<html>
	<head>
	    <meta charset="utf-8"/>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	    <meta name="description" content="Tizen Reader"/>
	
	    <title>Tizen Reader</title>
	
		<!-- framework -->
	    <link rel="stylesheet" href="./css/jquery.mobile-1.3.2.css"/>
	    <script type="text/javascript" src="./js/jquery-1.9.1.js"></script>
	    <script type="text/javascript" src="./js/jquery.mobile-1.3.2.js"></script>
	    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
	    
	    <!-- application -->
	    <link rel="stylesheet" href="./css/style.css" />
	    <script type="text/javascript" src="./js/main.js"></script>
	    <script type="text/javascript">

	    	function Feed() {
	    		this.url = "";
	    		this.title = "";
	    	}
	    	Feed.prototype = {};
	    	
	    	function FeedsManager() {
	    		this.feeds = [];
	    	}    	
	    	FeedsManager.prototype = {};
	    	FeedsManager.prototype.add = function(item){
		    	"use strict";	    	
	    		this.feeds.push(item);
	    	}
	    	
	    	FeedsManager.prototype.remove = function(feed){
		    	"use strict";	    	
	    		this.feeds.pop(feed);
	    	}
	    	
	    	var feedsManager = new FeedsManager();
	    	
		    function addNewFeed(value) {
		    	"use strict";		    
		    	var title = $(value).text();
		    	var url = value.id;
		    	
		    	var html = '<li data-icon="minus" onclick="removeFeed(this);" id="'+url+'" ><a class="ui-link-inherit feed_list_item">'+title+'</a></li>';
				$(value).replaceWith(html);
				$("#feed_search_result").listview('refresh');
				
				var feed = new Feed();
				feed.title = title;
				feed.url = url;
				feedsManager.add(feed);
				//update list of feeds
				loadFeedsMenu();
		    }
		    
		    function removeFeed(value) {
				"use strict";		    
				var title = $(value).text();
		    	var url = value.id;		    	
		    	var html = '<li data-icon="plus" onclick="addNewFeed(this);" id="'+url+'" ><a class="ui-link-inherit feed_list_item">'+title+'</a></li>';
				$(value).replaceWith(html);
				$("#feed_search_result").listview('refresh');
				
				feedsManager.remove(value);
				loadFeedsMenu();
			}

			//load the saved feeds
			function loadFeedsMenu(){
				var feeds = feedsManager.feeds;
				var html = '';
				for (var i = 0; i < feeds.length; i++) {
					var feed = feeds[i];
					var count = getUnreadFeeds(feed.url, i);
					html += '<li><a class="ui-link-inherit feed_list_item" href="'+feed.url+'">'+feed.title+'<span class="ui-li-count"><span id="'+i+'"0</span></span></a></li>';
				}
				$("#list_of_added_feeds").html(html);
				$("#list_of_added_feeds").listview('refresh');
			}
		    
		    google.load("feeds", "1");
		
		    function onFeedsSearchButtonClick() {
		    	var query = $("#search_field").val();
	  			google.feeds.findFeeds(query, onFeedSearchResult);
		    }
		    
		    
		    function onFeedSearchResult(result) {
				if (!result.error) {
					var html = '';
					
					for (var i = 0; i < result.entries.length; i++) {
						var entry = result.entries[i];
						this.title = entry.title;
						html += '<li data-icon="plus" onclick="addNewFeed(this)" id="' + entry.url + '"><a class="ui-link-inherit feed_list_item">' + entry.title + '</a></li>';
					}
					$("#feed_search_result").html(html);
					$("#feed_search_result").listview('refresh');
					
				}
			}
			
			function findFeedsFromUrl(url){				
				var feed = new google.feeds.Feed(url);
				feed.load(function(result){
					if(!result.error){
						var container = $("#app_content");
						var html = '';
						for(var i = 0; i < result.feed.entries.length; i++){
							var entry = result.feed.entries[i];
							html += entry.title;
							html +=entry.content;							
						}
						$(container).replaceWith(html);
					} else {
						alert(result.error.message);
					}
				});
			}
			
			function getUnreadFeeds(url, index){				
				var feed = new google.feeds.Feed(url);
				feed.load(function(result){
					if(!result.error){
						$("#"+index).html('<span id="'+index+'" >'+result.feed.entries.length+'</span>');
						$("#feed_search_result").listview('refresh');
					}
				});
			}
			
	    </script>
	</head>
	
	<body>
	    <div id="app_page" data-role="page">
	    
	    	<!-- menu panel -->
	    	<div id="menu_panel" data-role="panel" data-display="overlay" data-position="left">
		        <ul id="list_of_added_feeds" data-role="listview" data-inset="false">
				   <li><a class="ui-link-inherit feed_list_item" href="#">All<span class="ui-li-count">58</span></a></li>
				    <li><a class="ui-link-inherit feed_list_item" href="#">Gizmodo<span class="ui-li-count">20</span></a></li>
				    <li><a class="ui-link-inherit feed_list_item" href="#">Lifehacker <span class="ui-li-count">38</span></a></li> 
				</ul>
		    </div>
		    
		    <!-- add feed panel -->
	    	<div id="add_feed_button" data-role="panel" data-display="overlay" data-position="right">
   				<input id="search_field" name="Search" type="search" value="" placeholder="Search" onkeypress="onFeedsSearchButtonClick()" />
	   			
	   			<ul id="feed_search_result" data-role="listview" data-inset="false">				   
				</ul>
		    </div>
	    
	    	<!-- header -->
	        <div id="app_header" data-role="header" data-position="fixed" data-tap-toggle="false">
	            <h1>Tizen Reader</h1>
	            <a id="menu_button" data-role="button" data-icon="bars" href="#menu_panel" data-iconpos="notext" class="ui-btn-left" data-iconshadow="false" data-inline="true">Feeds</a>
	            <a id="add_feed_button" data-role="button" data-icon="plus" href="#add_feed_button" data-iconpos="notext" class="ui-btn-right" data-iconshadow="false" data-inline="true">Add feed</a>
	        </div>
	        
			<!-- content -->
	        <div id="app_content" data-role="content">
	            <ul data-role="listview" data-inset="false">
				    <li data-icon="false">
				    	<a href="details.html" data-transition="slide">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro...</p>
				    	</a>
				    </li>
				    <li data-icon="false">
				    	<a href="#">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro e atraindo a curiosidade de muitas pessoas. Por isso, 
					           a procura pelo produto também...</p>
				    	</a>
				    </li>
				    <li data-icon="false">
				    	<a href="#">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro e atraindo a curiosidade de muitas pessoas. Por isso, 
					           a procura pelo produto também...</p>
				    	</a>
				    </li>
				    <li data-icon="false">
				    	<a href="#">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro e atraindo a curiosidade de muitas pessoas. Por isso, 
					           a procura pelo produto também...</p>
				    	</a>
				    </li>
				    <li data-icon="false">
				    	<a href="#">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro e atraindo a curiosidade de muitas pessoas. Por isso, 
					           a procura pelo produto também...</p>
				    	</a>
				    </li>
				    <li data-icon="false">
				    	<a href="#">
					        <p><strong>Vale a pena comprar um drone? Entenda quais são riscos e benefícios</strong></p>
					        <p>Os drones vêm tomando conta do espaço brasileiro e atraindo a curiosidade de muitas pessoas. Por isso, 
					           a procura pelo produto também...</p>
				    	</a>
				    </li>
				</ul>
	        </div>
	        
	        <!-- footer -->
	        <div id="app_footer" data-role="footer" data-position="fixed" class="ui-bar">
			    <a id="previous_button" href="#" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-iconpos="left" class="ui-btn-left">Previous</a>
			    <a id="next_button" href="#" data-role="button" data-icon="arrow-r" data-iconpos="notext" data-iconpos="right" class="ui-btn-right">Next</a>
			</div>
	    </div>
	</body>
</html>